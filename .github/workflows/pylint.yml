name: Pylint

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.11"]
    steps:
    - uses: actions/checkout@v4
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v3
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pylint
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - name: Fetch all branches
      run: git fetch origin +refs/heads/*:refs/remotes/origin/*
    - name: Check if HEAD is detached
      run: |
        if [ "$(git rev-parse --abbrev-ref HEAD)" = "HEAD" ]; then
          echo "HEAD is in a detached state"
        else
          echo "HEAD is attached to branch: $(git rev-parse --abbrev-ref HEAD)"
        fi
    - name: Compare changes against master
      run: git diff origin/master...HEAD
    - name: Get Changed Python Files
      id: changes
      run: |
        echo $(git diff --name-only origin/master...HEAD -- '*.py' | tr '\n' ' ')
        echo "::set-output name=files::$(git diff --name-only origin/master...HEAD -- '*.py' | tr '\n' ' ')"
    - name: Analysing the changed files with pylint
      run: |
        if [ -n "${{ steps.changes.outputs.files }}" ]; then
          echo "Running pylint on changed files: ${{ steps.changes.outputs.files }}"
          pylint ${{ steps.changes.outputs.files }}
        else
          echo "No Python files changed."
        fi
        
